{% extends "store/base.html" %}

{% block title %}Warehouse Inventory{% endblock %}

{% block content %}
<div class="level">
    <div class="level-left">
        <div>
            <p class="title">Warehouse Inventory Overview</p>
            <p class="subtitle">Monitor stock levels, fulfillment activity, and drill into individual locations.</p>
        </div>
    </div>
</div>

{% for warehouse in warehouses %}
<div class="box">
    <div class="level">
        <div class="level-left">
            <div>
                <p class="title is-5">{{ warehouse.name }} ({{ warehouse.code }})</p>
                <p class="subtitle is-6">{{ warehouse.address.line1 }}, {{ warehouse.address.city }}{% if warehouse.address.state %}, {{ warehouse.address.state }}{% endif %}</p>
                <p class="has-text-grey">SKUs: {{ warehouse.inventory.all|length }} | Orders fulfilled: {{ warehouse.fulfilled_orders_count }}</p>
            </div>
        </div>
        <div class="level-right">
            <a class="button is-link is-light" href="{% url 'warehouse-detail' warehouse.pk %}">View details</a>
        </div>
    </div>
    <div class="table-container">
        <table class="table is-fullwidth is-hoverable is-striped">
            <thead>
                <tr>
                    <th>Book</th>
                    <th class="has-text-centered">On Hand</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                {% for stock in warehouse.inventory.all %}
                <tr class="{% if stock.quantity <= low_stock_threshold %}has-background-warning-light{% endif %}">
                    <td>{{ stock.book.title }}</td>
                    <td class="has-text-centered">{{ stock.quantity }}</td>
                    <td>
                        {% if stock.quantity <= low_stock_threshold %}
                            <span class="tag is-warning">Low</span>
                        {% else %}
                            <span class="tag is-success">Healthy</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="has-text-centered has-text-grey">No inventory recorded.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% empty %}
    <article class="message is-warning">
        <div class="message-body">No warehouses available.</div>
    </article>
{% endfor %}

<div class="box">
    <p class="title is-5">Order fulfillment by warehouse</p>
    <div class="table-container">
        <table class="table is-fullwidth is-hoverable is-striped">
            <thead>
                <tr>
                    <th>Order</th>
                    <th>Warehouse</th>
                    <th>Tracking</th>
                    <th>Shipped</th>
                </tr>
            </thead>
            <tbody>
                {% for shipment in fulfillments %}
                <tr>
                    <td><a href="{% url 'invoice-update' shipment.order.pk %}">{{ shipment.order.order_number }}</a></td>
                    <td>{{ shipment.warehouse.code }} - {{ shipment.warehouse.name }}</td>
                    <td>{{ shipment.tracking_number }}</td>
                    <td>{{ shipment.shipped_at|date:"Y-m-d"|default:"Pending" }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="has-text-centered has-text-grey">No shipments have been associated with warehouses.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
